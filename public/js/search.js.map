{"version":3,"sources":["search.coffee"],"names":[],"mappings":"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","file":"search.js","sourceRoot":"/source/","sourcesContent":["# Globals\n# ----------------------------\n\n$results = []\n$search = null\n\n# Submit Search\n# ----------------------------\n\n$('#submit-search').click (e) ->\n  console.log 'Hello from search.'\n  \n  # show loading icon, hide and clear result table\n  e.preventDefault()\n  $('.loading').fadeIn()\n  $('.search-results-table').hide()\n  $('.no-results').hide()\n  $('.search-results-table').find('tbody').html('');\n\n  # request data from discogs.com\n  $search = $.ajax\n    url: '/search'\n    type: 'POST'\n    data: \n      _token: $(\"#search-vinyl-form input[name='_token']\").val()\n      artist: $(\"#search-vinyl-form input[name='artist']\").val()\n      title: $(\"#search-vinyl-form input[name='title']\").val()\n      catno: $(\"#search-vinyl-form input[name='catno']\").val()\n    dataType: 'JSON'\n    error: (x,status,error) ->\n      console.log status\n      console.log error\n      if error == 'abort'\n        $('.loading').fadeOut()\n      else\n        $('.loading').html('<p class=\"h1\">Oops!</p><p class=\"lead\">Try refreshing your Discogs Connection</p><a href=\"/oauth/discogs\" class=\"btn btn-lg btn-primary\">Refresh Discogs Token</a>')\n\n    success: (results) -> # search results received\n      # console.log results\n      $results = results\n      $index = 0\n      $('.loading').fadeOut ->\n        if results.length\n          $('.search-results-table').fadeIn()\n          _.each results, (result) ->\n            #console.log result\n\n            # artist\n            if result.artists\n              $artist = result.artists[0].name\n            else\n              $artist = '<em>unknown artist</em>'\n\n            # cover\n            if result.images\n              $cover = result.images[0].uri150\n            else\n              $cover = '/images/PH_vinyl.svg'\n\n            # title\n            if result.title\n              $title = result.title\n            else\n              $title = '<em>unknown title</em>'\n\n            # catno\n            if result.type == 'release'\n              $catno = result.labels[0].catno\n            else\n              $catno = '<em>no catalog number</em>'\n\n            # link\n            $link = '/vinyl/add?id='+result.id+'?type='+result.type\n\n            $vinyl = '<tr><td class=\"cover\"><img src=\"'+$cover+'\" alt=\"cover\"></td><td>'+$artist+'</td><td>'+$title+'</td><td>'+$catno+'</td><td><a href=\"'+$link+'\" class=\"btn btn-sm btn-info\"><i class=\"fa fa-fw fa-edit\"></i> Edit</a><button class=\"btn btn-sm btn-success quick-add\" data-toggle=\"modal\" data-target=\"#quickAddVinyl\" data-result=\"'+$index+'\"><i class=\"fa fa-fw fa-plus\"></i> Quick add</button></td></tr>';\n            $('.search-results-table').find('tbody').append($vinyl);\n\n            # increase index\n            $index++\n        else\n          $('.no-results').fadeIn()\n\n# Cancel search\n# ----------------------------\n\n$('#cancel-search').click ->\n  $('.loading').fadeOut()\n  $search.abort()\n\n# Close Modal\n# ----------------------------\n\n$('#quickAddVinyl').on 'hide.bs.modal', (e) ->\n  $('#addVinylForm .trackInfo').remove()\n\n# Quick add\n# ----------------------------\n\n$('#quickAddVinyl').on 'show.bs.modal', (e) ->\n  button = $(e.relatedTarget)\n  vinyl_index = button.data 'result'\n  vinyl = $results[vinyl_index]\n  console.log vinyl\n\n  # artist\n  if vinyl.artists\n    $artist = vinyl.artists[0].name\n  else\n    $artist = 'unknown artist'\n\n  # title\n  if vinyl.title\n    $title = vinyl.title\n  else\n    $title = 'unknown title'\n\n  # cover\n  if vinyl.images\n    $cover = vinyl.images[0].uri\n  else\n    $cover = 'images/PH_vinyl.svg'\n\n  # label & catno\n  if vinyl.labels\n    $label = vinyl.labels[0].name\n    if vinyl.labels[0].catno\n      $catno = vinyl.labels[0].catno\n    else\n      $catno = 'unknown catno'\n  else\n    $label = 'unknown label'\n\n  # genre\n  if vinyl.genres\n    $genre = vinyl.genres[0]\n  else\n    $genre = 'unknown genre'\n\n  # country\n  if vinyl.country\n    $country = vinyl.country\n  else\n    $country = 'unknown country'\n\n  # year\n  if vinyl.year\n    $year = vinyl.year\n  else\n    $year = 'unknown year'\n\n  # count\n  if vinyl.format_quantity\n    $count = vinyl.format_quantity\n  else\n    $count = 'unknown quantity'\n\n  # weight\n  if vinyl.estimated_weight\n    $weight = vinyl.estimated_weight\n  else\n    $weight = '0'\n\n  # type\n  if vinyl.type\n    $type = vinyl.type\n  else\n    $type = '-'\n\n  # color\n  $color = '#000000'\n\n  # size\n  $size = '12'\n\n  # format\n  $format = 'LP'\n\n  # tracklist\n  if vinyl.tracklist\n    $tracklist = vinyl.tracklist\n  else\n    $tracklist = []\n\n\n  # visible form data\n  modal = $(this)\n  modal.find('.modal-title').text('Add \"' + vinyl.artists[0].name + ' - '+ vinyl.title + '\" to collection')\n  modal.find('.modal-body .cover').html('<img src=\"'+$cover+'\" class=\"thumbnail\" width=\"100%\">')\n  \n  # invisible form data\n  modal.find('input[name=\"artist\"]').val($artist)\n  modal.find('input[name=\"title\"]').val($title)\n  modal.find('input[name=\"cover\"]').val($cover)\n  modal.find('input[name=\"label\"]').val($label)\n  modal.find('input[name=\"catno\"]').val($catno)\n  modal.find('input[name=\"genre\"]').val($genre)\n  modal.find('input[name=\"country\"]').val($country)\n  modal.find('input[name=\"year\"]').val($year)\n  modal.find('input[name=\"count\"]').val($count)\n  modal.find('input[name=\"color\"]').val($color)\n  modal.find('input[name=\"format\"]').val($format)\n  modal.find('input[name=\"size\"]').val($size)\n  modal.find('input[name=\"weight\"]').val($weight)\n  modal.find('input[name=\"type\"]').val($type)\n  modal.find('input[name=\"trackCount\"]').val($tracklist.length)\n  _.each $tracklist, (track, index) ->\n    #console.log track\n    modal.find('#addVinylForm').append('<input class=\"trackInfo\" name=\"track_'+index+'_title\" type=\"hidden\" value=\"'+track.title+'\"/>');\n    modal.find('#addVinylForm').append('<input class=\"trackInfo\" name=\"track_'+index+'_position\" type=\"hidden\" value=\"'+track.position+'\"/>');\n    modal.find('#addVinylForm').append('<input class=\"trackInfo\" name=\"track_'+index+'_duration\" type=\"hidden\" value=\"'+track.duration+'\"/>');\n"]}