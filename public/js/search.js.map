{"version":3,"sources":["search.coffee"],"names":[],"mappings":"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","file":"search.js","sourceRoot":"/source/","sourcesContent":["# Globals\n# ----------------------------\n\n$results = []\n$search = null\n\nEURinUSD = 1.14 # USD\nEURinGBP = 0.73 # GBP\nGBPinUSD = 1.53 # USD\n\n# Calc Median\n# ----------------------------\n\ngetMedian = (values) ->\n  values.sort  (a,b)=> return a - b\n  half = Math.floor values.length/2\n  if values.length % 2 \n    return values[half]\n  else\n    return (values[half-1] + values[half]) / 2.0\n\n# Submit Search\n# ----------------------------\n\n$('#submit-search').click (e) ->\n  # console.log 'Hello from search.'\n  \n  # show loading icon, hide and clear result table\n  e.preventDefault()\n  $('.loading').fadeIn()\n  $('.search-results-table').hide()\n  $('.no-results').hide()\n  $('.search-results-table').find('tbody').html('');\n\n  # request data from discogs.com\n  $search = $.ajax\n    url: '/search'\n    type: 'POST'\n    data: \n      _token: $(\"#search-vinyl-form input[name='_token']\").val()\n      artist: $(\"#search-vinyl-form input[name='artist']\").val()\n      title: $(\"#search-vinyl-form input[name='title']\").val()\n      catno: $(\"#search-vinyl-form input[name='catno']\").val()\n    dataType: 'JSON'\n    error: (x,status,error) ->\n      console.log status\n      console.log error\n      if error == 'abort'\n        $('.loading').fadeOut()\n      else\n        $('.loading').html('<p class=\"h1\">Oops!</p><p class=\"lead\">Try refreshing your Discogs Connection</p><a href=\"/oauth/discogs\" class=\"btn btn-lg btn-primary\">Refresh Discogs Token</a>')\n\n    success: (results) -> # search results received\n      # console.log results\n      $results = results\n      $index = 0\n      $('.loading').fadeOut ->\n        if results.length\n          $('.search-results-table').fadeIn()\n          _.each results, (result) ->\n            #console.log result\n\n            # artist\n            if result.artists\n              $artist = result.artists[0].name\n            else\n              $artist = '<em>unknown artist</em>'\n\n            # cover\n            if result.images\n              $cover = result.images[0].uri150\n            else\n              $cover = '/images/PH_vinyl.svg'\n\n            # title\n            if result.title\n              $title = result.title\n            else\n              $title = '<em>unknown title</em>'\n\n            # catno\n            if result.type == 'release'\n              $catno = result.labels[0].catno\n            else\n              $catno = '<em>no catalog number</em>'\n\n            # link\n            $link = '/vinyl/add?id='+result.id+'?type='+result.type\n\n            $vinyl = '<tr><td class=\"cover\"><img src=\"'+$cover+'\" alt=\"cover\"></td><td>'+$artist+'</td><td>'+$title+'</td><td>'+$catno+'</td><td><!--<a href=\"'+$link+'\" class=\"btn btn-sm btn-info\"><i class=\"fa fa-fw fa-edit\"></i> Edit</a>--><button class=\"btn btn-sm btn-success quick-add\" data-toggle=\"modal\" data-target=\"#quickAddVinyl\" data-result=\"'+$index+'\"><i class=\"fa fa-fw fa-plus\"></i> Add</button></td></tr>';\n            $('.search-results-table').find('tbody').append($vinyl);\n\n            # increase index\n            $index++\n        else\n          $('.no-results').fadeIn()\n\n# Cancel search\n# ----------------------------\n\n$('#cancel-search').click ->\n  $('.loading').fadeOut()\n  $search.abort()\n\n# Close Modal\n# ----------------------------\n\n$('#quickAddVinyl').on 'hidden.bs.modal', (e) ->\n  modal = $(this)\n  $('#modalSubmit').disabled = true         # disable submit\n  $('#addVinylForm .trackInfo').remove()    # remove track infos\n  $('#currencyLabel').hide()                # remove price\n  modal.find('input[name=\"price\"]').before('<input type=\"hidden\" name=\"price\"/>').remove()\n  unless($('#price').length)                # as long as not already present\n    modal.find('input[name=\"price\"]').before('<p class=\"h1\" id=\"price\">Fetching...</p>') # show price text\n  else\n    $('#price').text('Fetching...')\n  $('#priceLabelText').text('Discogs median price:')\n\n# Quick add\n# ----------------------------\n\n$('#quickAddVinyl').on 'show.bs.modal', (e) ->\n  button = $(e.relatedTarget)\n  vinyl_index = button.data 'result'\n  vinyl = $results[vinyl_index]\n  modal = $(this)\n  console.log vinyl\n\n  # fetch price\n  $priceRequest = $.ajax\n    url: '//api.discogs.com/marketplace/search?release_id='+vinyl.id\n    type: 'GET'\n    dataType: 'JSON'\n    error: (x,status,error) ->\n      console.log status\n      console.log error\n    success: (prices) -> # search results received\n      # console.log prices\n      userCurrency = $('#userCurrency').val()\n      values = []\n      median = 0\n\n      # convert all prices to EUR and add up\n      _.each prices, (price) ->\n        currency = price.currency\n        \n        switch(price.currency)\n          when 'EUR'\n            values.push(parseInt(price.price.substr(1)))\n          when 'GBP'\n            values.push(parseInt(price.price.substr(1)) / EURinGBP)\n          when 'USD'\n            values.push(parseInt(price.price.substr(1)) / EURinUSD)\n      \n      # calc median\n      median = getMedian(values).toFixed(2)\n\n      # convert to users currency\n      switch(userCurrency)\n        when 'EUR'\n          median = median\n        when 'GBP'\n          median = median * EURinGBP\n        when 'USD'\n          median = median * EURinUSD\n\n      # show the price & add to form\n      if(isNaN(median))\n        # no prices on Discogs -> show text input for price\n        modal.find('input[name=\"price\"]').before('<input type=\"text\" name=\"price\" class=\"form-control\" placeholder=\"required\" required aria-describedby=\"currencyLabel\"/>').remove()\n        $('#currencyLabel').text(userCurrency).show()\n        $('#price').remove()\n        $('#priceLabelText').text('What did you pay?')\n      else\n        $('#price').html(median+' '+userCurrency)\n        modal.find('input[name=\"price\"]').val(median)\n\n      # enable submit button\n      $('#modalSubmit').disabled = false\n\n  # artist\n  if vinyl.artists\n    $artist = vinyl.artists[0].name\n  else\n    $artist = 'unknown artist'\n\n  # title\n  if vinyl.title\n    $title = vinyl.title\n  else\n    $title = 'unknown title'\n\n  # cover\n  if vinyl.images\n    $cover = vinyl.images[0].uri\n  else\n    $cover = 'images/PH_vinyl.svg'\n\n  # label & catno\n  if vinyl.labels\n    $label = vinyl.labels[0].name\n    if vinyl.labels[0].catno\n      $catno = vinyl.labels[0].catno\n    else\n      $catno = 'unknown catno'\n  else\n    $label = 'unknown label'\n\n  # genre\n  if vinyl.genres\n    $genre = vinyl.genres[0]\n  else\n    $genre = 'unknown genre'\n\n  # country\n  if vinyl.country\n    $country = vinyl.country\n  else\n    $country = 'unknown country'\n\n  # year\n  if vinyl.year\n    $year = vinyl.year\n  else\n    $year = 'unknown year'\n\n  # count\n  if vinyl.format_quantity\n    $count = vinyl.format_quantity\n  else\n    $count = 'unknown quantity'\n\n  # weight\n  if vinyl.estimated_weight\n    $weight = vinyl.estimated_weight\n  else\n    $weight = '0'\n\n  # type\n  if vinyl.type\n    $type = vinyl.type\n  else\n    $type = '-'\n\n  # color\n  $color = '#000000'\n\n  # size\n  $size = '12'\n\n  # format\n  $format = 'LP'\n\n  # release ID\n  $release_id = vinyl.id\n\n  # Discogs URI\n  $discogs_uri = vinyl.uri\n\n  # tracklist\n  if vinyl.tracklist\n    $tracklist = vinyl.tracklist\n  else\n    $tracklist = []\n\n  # videos\n  if vinyl.videos\n    $videos = vinyl.videos\n  else\n    $videos = []\n\n  # visible form data\n  modal.find('.modal-title').text('Add \"' + vinyl.artists[0].name + ' - '+ vinyl.title + '\" to collection')\n  modal.find('.modal-body .cover').html('<img src=\"'+$cover+'\" class=\"thumbnail\" width=\"100%\">')\n  \n  # invisible form data\n  modal.find('input[name=\"artist\"]').val($artist)\n  modal.find('input[name=\"title\"]').val($title)\n  modal.find('input[name=\"cover\"]').val($cover)\n  modal.find('input[name=\"label\"]').val($label)\n  modal.find('input[name=\"catno\"]').val($catno)\n  modal.find('input[name=\"genre\"]').val($genre)\n  modal.find('input[name=\"country\"]').val($country)\n  modal.find('input[name=\"year\"]').val($year)\n  modal.find('input[name=\"count\"]').val($count)\n  modal.find('input[name=\"color\"]').val($color)\n  modal.find('input[name=\"format\"]').val($format)\n  modal.find('input[name=\"size\"]').val($size)\n  modal.find('input[name=\"weight\"]').val($weight)\n  modal.find('input[name=\"type\"]').val($type)\n  modal.find('input[name=\"release_id\"]').val($release_id)\n  modal.find('input[name=\"discogs_uri\"]').val($discogs_uri)\n  modal.find('input[name=\"trackCount\"]').val($tracklist.length)\n  modal.find('input[name=\"videoCount\"]').val($videos.length)\n  _.each $tracklist, (track, index) ->\n    #console.log track\n    modal.find('#addVinylForm').append('<input class=\"trackInfo\" name=\"track_'+index+'_title\" type=\"hidden\" value=\"'+track.title+'\"/>');\n    modal.find('#addVinylForm').append('<input class=\"trackInfo\" name=\"track_'+index+'_position\" type=\"hidden\" value=\"'+track.position+'\"/>');\n    modal.find('#addVinylForm').append('<input class=\"trackInfo\" name=\"track_'+index+'_duration\" type=\"hidden\" value=\"'+track.duration+'\"/>');\n  _.each $videos, (video, index) ->\n    #console.log video\n    # rewrite uri to embed uri\n    uri = \"//www.youtube.com/embed/\"+video.uri.substr(video.uri.length-11)\n    modal.find('#addVinylForm').append('<input class=\"videoInfo\" name=\"video_'+index+'_title\" type=\"hidden\" value=\"'+video.title+'\"/>');\n    modal.find('#addVinylForm').append('<input class=\"videoInfo\" name=\"video_'+index+'_uri\" type=\"hidden\" value=\"'+uri+'\"/>');\n    modal.find('#addVinylForm').append('<input class=\"videoInfo\" name=\"video_'+index+'_duration\" type=\"hidden\" value=\"'+video.duration+'\"/>');\n"]}