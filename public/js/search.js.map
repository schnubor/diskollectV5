{"version":3,"sources":["search.coffee"],"names":[],"mappings":"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","file":"search.js","sourceRoot":"/source/","sourcesContent":["# Globals\n# ----------------------------\n\n$results = []\n\n# Submit Search\n# ----------------------------\n\n$('#submit-search').click (e) ->\n  console.log 'Hello from search.'\n  \n  # show loading icon, hide and clear result table\n  e.preventDefault()\n  $('.loading').fadeIn()\n  $('.search-results-table').hide()\n  $('.no-results').hide()\n  $('.search-results-table').find('tbody').html('');\n\n  # request data from discogs.com\n  search = $.ajax\n    url: '/search'\n    type: 'POST'\n    data: \n      _token: $(\"input[name='_token']\").val()\n      artist: $(\"input[name='artist']\").val()\n      title: $(\"input[name='title']\").val()\n      catno: $(\"input[name='catno']\").val()\n    dataType: 'JSON'\n    success: (results) -> # search results received\n      # console.log results\n      $results = results\n      $index = 0\n      $('.loading').fadeOut ->\n        if results.length\n          $('.search-results-table').fadeIn()\n          _.each results, (result) ->\n            #console.log result\n\n            # artist\n            if result.artists\n              $artist = result.artists[0].name\n            else\n              $artist = '<em>unknown artist</em>'\n\n            # cover\n            if result.images\n              $cover = result.images[0].uri150\n            else\n              $cover = '/images/PH_vinyl.svg'\n\n            # title\n            if result.title\n              $title = result.title\n            else\n              $title = '<em>unknown title</em>'\n\n            # catno\n            if result.type == 'release'\n              $catno = result.labels[0].catno\n            else\n              $catno = '<em>no catalog number</em>'\n\n            # link\n            $link = '/vinyl/add?id='+result.id+'?type='+result.type\n\n            $vinyl = '<tr><td class=\"cover\"><img src=\"'+$cover+'\" alt=\"cover\"></td><td>'+$artist+'</td><td>'+$title+'</td><td>'+$catno+'</td><td><a href=\"'+$link+'\" class=\"btn btn-sm btn-info\"><i class=\"fa fa-fw fa-edit\"></i> Edit</a><button class=\"btn btn-sm btn-success quick-add\" data-toggle=\"modal\" data-target=\"#quickAddVinyl\" data-result=\"'+$index+'\"><i class=\"fa fa-fw fa-plus\"></i> Quick add</button></td></tr>';\n            $('.search-results-table').find('tbody').append($vinyl);\n\n            # increase index\n            $index++\n        else\n          $('.no-results').fadeIn()\n\n# Quick add\n# ----------------------------\n\n$('#quickAddVinyl').on 'show.bs.modal', (e) ->\n  button = $(e.relatedTarget)\n  vinyl_index = button.data 'result'\n  vinyl = $results[vinyl_index]\n  console.log vinyl\n\n  # vinyl data\n  $artist = vinyl.artists[0].name\n  $title = vinyl.title\n  $cover = vinyl.images[0].uri\n\n  modal = $(this)\n  modal.find('.modal-title').text('Add \"' + vinyl.artists[0].name + ' - '+ vinyl.title + '\" to collection')\n  modal.find('.modal-body .cover').html('<img src=\"'+$cover+'\" class=\"thumbnail\" width=\"100%\">')\n  \n\n    "]}